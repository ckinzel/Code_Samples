simulation_output
    enable all   
	event_output
		file "my_results.evt"
      flush_output enable
    end_event_output
end_simulation_output

event_output
	file "default.evt"
	enable all
end_event_output

platform foo1 WSF_PLATFORM
	side blue

   position 45n 45e altitude 1500 ft 
end_platform

platform foo2 WSF_PLATFORM
	side red
end_platform

# Check results
observer 
   enable SIMULATION_COMPLETE
end_observer

script_variables
   Map<int, string> EXPECTED_CONTENT = Map<int,string>();
   
   EXPECTED_CONTENT[1]  = "0.00000 PLATFORM_ADDED foo1 Type: WSF_PLATFORM Side: blue \\";
   EXPECTED_CONTENT[4]  = "0.00000 TEAM_NAME_DEFINITION foo1 blue";
   EXPECTED_CONTENT[5]  = "0.00000 PLATFORM_INITIALIZED foo1 Type: WSF_PLATFORM Side: blue \\";
   EXPECTED_CONTENT[8]  = "0.00000 ROUTER_OPERATIONAL foo1 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[11] = "0.00000 PLATFORM_ADDED foo2 Type: WSF_PLATFORM Side: red \\";
   EXPECTED_CONTENT[14] = "0.00000 TEAM_NAME_DEFINITION foo2 red";
   EXPECTED_CONTENT[15] = "0.00000 PLATFORM_INITIALIZED foo2 Type: WSF_PLATFORM Side: red \\";
   EXPECTED_CONTENT[18] = "0.00000 ROUTER_OPERATIONAL foo2 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[21] = "0.00000 NETWORK_ADDED default Address: 0.1.0.0";
   EXPECTED_CONTENT[22] = "0.00000 ROUTER_TURNED_ON foo1 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[25] = "0.00000 ROUTER_TURNED_ON foo2 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[28] = "0.00000 SIMULATION_STARTING Year: 2003 Month: 6 Day: 1 Hour: 12 Minute: 0 Second: 0";
   EXPECTED_CONTENT[29] = "0.00000 ROUTER_TURNED_ON foo1 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[32] = "0.00000 ROUTER_TURNED_ON foo2 Router: default Type: WSF_COMM_ROUTER \\";
   EXPECTED_CONTENT[35] = "60.00100 SIMULATION_COMPLETE Year: 2003 Month: 6 Day: 1 Hour: 12 Minute: 1 Second: 0";
   EXPECTED_CONTENT[36] = "60.00100 PLATFORM_DELETED foo1 Type: WSF_PLATFORM Side: blue Ps: 1 \\";
   EXPECTED_CONTENT[39] = "60.00100 PLATFORM_DELETED foo2 Type: WSF_PLATFORM Side: red Ps: 1 \\";
end_script_variables

script void SimulationComplete()
   FileIO file = FileIO();
   bool success = file.Open("my_results.evt", "in");
   
   int lncount = 1;
   string line = file.Readln();
   while(!file.Eof())
   {
      if(EXPECTED_CONTENT.Exists(lncount))
      {
		bool matches = EXPECTED_CONTENT[lncount].StartsWith(line);
	    success = success && matches;
		  
		if(!matches)
		{
			writeln("MATCH ", (string)lncount, " FAILED\n\t[Expected]:", EXPECTED_CONTENT[lncount], "\n\t[Actual]:  ", line);
		}
		else
		{
			writeln("MATCH ", (string)lncount, " PASSED");
		}
      }
	  
	  lncount = lncount + 1;
	  line = file.Readln();
   }
   
   if(success)
   {
	writeln("-PASS-");
   }
   else
   {
	writeln("-FAIL-");
   }
   
end_script